<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-type" content="text/html;charset=UTF-8" />
        <link rel="stylesheet" href="./css/demo.css" />
        <link rel="stylesheet" href="./css/graph.css" />
        <link rel="stylesheet" href="./css/list.css" />
        <link rel="stylesheet" href="./css/terminal.css" />
        <link
            href="http://fonts.googleapis.com/css?family=Lato:400,700"
            rel="stylesheet"
            type="text/css"
        />
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

        <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
        <script src="./js/lib/jquery.mousewheel.min.js"></script>
        <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
        <script src="https://unpkg.com/jquery.terminal/js/jquery.terminal.min.js"></script>
        <link rel="stylesheet" href="https://unpkg.com/jquery.terminal/css/jquery.terminal.min.css"/>
    
    </head>


    <body>


        <div id="main-display-view" onclick="console.log('maindisplay clicked');">
            <div id="graph-view-wrapper"></div>
        </div>

        <script>
            jQuery(document).ready(function($) {
                $(window).scroll(function() {
                    $('#terminal').each(function() {
                        $(this).css({top: $('body').prop('scrollTop')});
                    });
                });
            });
        </script>
        
        <!-- Terminal goes here. -->
        <div id="terminal">
           
            <!-- TODO: do some event listener that saves this graph to JSON file -->
            <!-- <button class = "button" onclick="
                var dispatcher = document.getElementById('event-dispatcher');
                const saveEvent = new CustomEvent('save', {
                    bubbles: true,
                }); 
                dispatcher.dispatchEvent(saveEvent); 
            ">SAVE GRAPH</button> -->
            
            <!-- Placeholder element. We attach dispatched events to this. -->
            <div id="event-dispatcher"></div>

            <script>
                var dispatcher = document.getElementById("event-dispatcher");

                /**************************************************************/
                /* Define the functions that our terminal will take as input. */
                /**************************************************************/
                
                var settings = {
                    prompt: '> ',
                    name: 'CLI',
                    height: 250,
                    enabled: false,
                    greetings: 'Welcome to the Command Line. \nModify your Study Graph here:',
                    keypress: function(e) {
                        if (e.which == 96) {
                            return false;
                        }
                    }
                };
                $("#terminal").terminal(
                    {

                        /* 
                            Add a node to the graph. 
                            If there's already a node with title=title, 
                            just update its summary. 
                        */
                        addNode: function(title, summary) {
                           
                            // Build an event and fire it. 
                            const event = new CustomEvent("addNode", {
                                bubbles: true,
                                detail: {
                                    title: title,
                                    summary: summary,
                                }
                            }); 
                            dispatcher.dispatchEvent(event);

                            
                            // Return the terminal output. 
                            return "Node \"" + title + "\" added to graph\n"; 
                        }, 

                        removeNode: function(title) {
                           
                            // Build an event and fire it. 
                            const event = new CustomEvent("removeNode", {
                                bubbles: true,
                                detail: {
                                    title: title,
                                }
                            }); 
                            dispatcher.dispatchEvent(event);

                            // TODO: return something if there isn't a node 
                            // called 'title'

                            return "";
                        },

                        /* Connect a parent and a child node. */
                        connect: function(parent, child) { 

                            // Build an event and fire it. 
                            const event = new CustomEvent("connect", {
                                bubbles: true,
                                detail: {
                                    parent: parent, 
                                    child: child,
                                }
                            }); 
                            dispatcher.dispatchEvent(event);
                            
                            setTimeout(function() {
                                $("#main-display-view").click();
                            }, 1000);

                            return "Node \"" + child + "\" made child of \"" + parent + "\"";
                        },

                        /********** HELP COMMANDS ************/
                        help: function(command) {
                            switch(command) {
                                case "addNode":
                                    return "\tusage: addNode \"title\" \"summary\""
                                case "connect": 
                                    return "\tusage: connect \"title of parent\" \"title of child\""
                                default: 
                                    return command + " not found"
                            }
                        },
                    },
                    settings
                )
            </script>
        </div>


        <!-- Underscore Templates -->
        <script type="text/template" id="concept-list-template">

            <div id="concept-list-show-button" class="small-vp-button">
              Concept List
            </div>

            <div id="concept-title-header">
              <h1>
                Concept List
              </h1>
              <div id="explore-learn-tools">
                <div id="concept-list-search">
                  <input type="text" id="concept-list-search-input" placeholder="enter the name of a concept to find it">
                  <input type="button" value="Clear" id="cancel-search-input" style="top: 39px;">
                </div>

                <div id="concept-list-hide-button" style="font-size: 1.4em; padding: 0  0.1em 0.2em 0.1em;">
                  Â«
                </div>

              </div>
            </div>

            <div id="concept-list-wrapper">
              <ol id="concept-list">
              </ol>
            </div>
        </script>

        <!-- js -->
        <script
            data-main="demo/demojs/custom.js"
            src="./js/lib/require-min.js"
        ></script>

        <script>
            /* TODO: 
            Get the element that corresponds with the terminal. 

            Create an event that fires on tilde press. 
            Maintain some state (is terminal visible or invisible?).
            Modify the css of the terminal div accordingly.

             */
            $('#terminal').hide();
            var focus = false;
            $(document.documentElement).keypress(function(e) {
                var term1 = $('#terminal')[0];
                
                if (e.which == 96) {
                    $('#terminal').slideToggle('fast')
                    term1.scrollTop = term1.scrollHeight;
                    $('#terminal').focus();
                }
            });
        </script>
    </body>
</html>
