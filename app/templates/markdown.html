<!DOCTYPE html>
<html>
<head>
    <!-- SG icon -->
    <title>Study Graph</title> 
    <link rel="icon" href="img/graph-favicon.png" type="image/x-icon">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.11.2/css/all.css">
    <!-- Google Fonts Roboto -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap">
    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">    
    <!-- Your custom styles (optional) -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <!-- For markdown editor -->
    <link rel="stylesheet" href="https://unpkg.com/easymde/dist/easymde.min.css">
    <script src="https://unpkg.com/easymde/dist/easymde.min.js"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='js/jquery.min.js') }}"></script>
    <!-- For markdown modal -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

    <!-- For markdown modal -->

    <script>
        jQuery(document).ready(function($) {
            $('#markdownModal').modal('show');
        });
    </script>

</head>
<body>
    <style> 
    .transparent {
        background-color: Transparent;
        background-repeat:no-repeat;
        border: none;
        cursor:pointer;
        overflow: hidden;
        outline:none;
        line-height:0;
        padding: 0px 0px;
        padding-left:1px;
    }
    </style>


    <!-- Markdown Modal -->
    <div class="modal multi-step" id="markdownModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header align-items-center">
                    <h4 class="modal-title step-1" data-step="1">Meet the Markdown Editor!</h4>
                    <h4 class="modal-title step-2" data-step="2">An Overview of Markdown Editing</h4>
                    <h4 class="modal-title step-3" data-step="2">Another Note on Saving Your Work</h4>
                    <button type="button" class="transparent" data-dismiss="modal">
                        <span style="margin-right:7px;font-size: 1.5em; color: rgba(252, 62, 62, 0.685);">
                            <i class="fas fa-times"></i>
                        </span>
                    </button>
                </div>
                <div class="modal-body step-1" data-step="1">
                    Use this tool to keep extra information about each node. Add notes, images, links or any other useful material for you to refer back to. 
                </div>
                <div class="modal-body step-2" data-step="2">
                </div>
                <div class="modal-body step-3" data-step="3">
                    Unlike on the main <span class = font-weight-bold>Graph Building</span> page you just left, you'll need to manually save your markdown. 
                    <br><br>
                    When you're ready, hit the <i class="fas fa-save"></i> button at the right end of the toolbar. 
                </div>
                <div class="modal-footer">
                    <button type="button" class="transparent step step-2 mr-auto" data-step="2" onclick="sendEvent('#demo-modal-3', 1)" style="float: left !important;">
                        <span style="font-size: 1.5em; color:rgba(1, 103, 255, 0.568);">
                            <i class="fas fa-arrow-circle-left"></i>
                        </span>
                    </button>
                    <button type="button" class="transparent step step-1" data-step="1" onclick="sendEvent('#demo-modal-3', 2)">
                        <span style="font-size: 1.5em; color:rgba(1, 103, 255, 0.568);">
                            <i class="fas fa-arrow-circle-right"></i>
                        </span>                        </button>
                    <button type="button" class="transparent step step-3 mr-auto" data-step="3" onclick="sendEvent('#demo-modal-3', 2)">
                        <span style="font-size: 1.5em; color:rgba(1, 103, 255, 0.568);">
                            <i class="fas fa-arrow-circle-left"></i>
                        </span>
                    </button>
                    <button type="button" class="transparent step step-2" data-step="2" onclick="sendEvent('#demo-modal-3', 3)">
                        <span style="font-size: 1.5em; color:rgba(1, 103, 255, 0.568);">
                            <i class="fas fa-arrow-circle-right"></i>
                        </span>
                    </button>
                    
                    
                </div>
            </div>
        </div>
    </div>
    


    <textarea></textarea>
    <script>
        
        // Get the URL parameters (graph id and node id)
        const urlParams = new URLSearchParams(window.location.search);
        const graphID = urlParams.get("graph_id"); 
        const nodeID = urlParams.get("node_id"); 
        const saveURL = "/node-save?" + "graph_id=" + graphID + "&node_id=" + nodeID;

        // On 'save', make a POST to the backend to save this content. 
        save = function() {
            $.post(saveURL, 
            {"markdown_text": easyMDE.value()}, 
            function() {
                console.log("save(): success"); 
            }); 
        }

        // Create the markdown editor. 
        var easyMDE = new EasyMDE({
            autoDownloadFontAwesome: true,
            tabSize: 4,
            toolbar: [
                "heading", "bold", "italic", "strikethrough", "|",
                "quote", "code", "unordered-list", "ordered-list", "|", 
                "link", "image", "table", "|",
                "preview", "side-by-side", "|",
                "guide", 
                {
                    name: "save", 
                    action: (editor) => {
                        save();
                    },
                    className: "fas fa-save", 
                    title: "Save"
                },
                {
                    name: "home", 
                    action: (editor) => {
                        save();
                        window.location.href = "/graph-load?graph_id=" + graphID;
                    }, 
                    className: "fa fa-home", 
                    title: "Home",
                }
            ]
        });
       
        // Load the stuff from the database. 
        $.post('/node-load', {'graph_id': graphID, 'node_id': nodeID}, 
            function(data, status) {
                easyMDE.value(data); 
            }
        );
    </script>

    <!-- multi-step modal js -->
    <script
        src="{{ url_for ('static', filename='js/multi-step-modal.js') }}"
    >
    </script>
    <script>
        sendEvent = function(sel, step) {
            var sel_event = new CustomEvent('next.m.' + step, {detail: {step: step}});
            window.dispatchEvent(sel_event);
        }
    </script>
</body>

<!-- jQuery -->
</html> 