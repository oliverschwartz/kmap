<!DOCTYPE html>
<html>
<head>
    <!-- SG icon -->
    <title>Study Graph</title> 
    <link rel="icon" href="img/graph-favicon.png" type="image/x-icon">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.11.2/css/all.css">
    <!-- Google Fonts Roboto -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap">
    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.min.css') }}">
    <!-- Material Design Bootstrap -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/mdb.min.css') }}">
    <!-- Your custom styles (optional) -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <!-- For markdown editor -->
    <link rel="stylesheet" href="https://unpkg.com/easymde/dist/easymde.min.css">
    <script src="https://unpkg.com/easymde/dist/easymde.min.js"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='js/jquery.min.js') }}"></script>

    <!-- For markdown modal -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

    <script>
        jQuery(document).ready(function($) {
            $('#markdownModal').modal('show');
        });
    </script>

</head>
<body>

    <!-- Multi-step Markdown Modal -->
    <div class="modal multi-step" id="markdownModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title step-1" data-step="1">Welcome!</h4>
                    <h4 class="modal-title step-2" data-step="2">Graph Building 101</h4>
                    <h4 class="modal-title step-3" data-step="2">A Note on Saving Your Work</h4>

                </div>
                <div class="modal-body step-1" data-step="1">
                    A few things to start off with: <br><br>
                    - You'll be using the <span class = font-weight-bold style="color: rgba(0, 102, 255, 0.973)">Command Line Interface</span> (<span class = font-weight-bold style="color: rgba(0, 102, 255, 0.973)">CLI</span>) to build and update your graph. <br>
                    - You can call the <span class = font-weight-bold style="color: rgba(0, 102, 255, 0.973)">CLI</span> with the <span class = font-weight-bold>tilde</span> key. <br> 
                    - Once your graph has a few nodes, you can use the concept list on the left to scroll and search through them. 
                    <br> <br> Hint: the <span class = font-weight-bold>tilde</span> key (`) is in the top left corner of your keyboard, just under esc. 
                </div>
                <div class="modal-body step-2" data-step="2">
                    The <span class = font-weight-bold style="color: rgba(0, 102, 255, 0.973)">CLI</span> lets you add nodes with unique titles and descriptions. 
                    For any node you add, you can edit its content, link it to another node, or remove it from the graph if you don't want it there anymore. <br><br>
                    After you call the <span class = font-weight-bold style="color: rgba(0, 102, 255, 0.973)">CLI</span> with the <span class = font-weight-bold>tilde</span> key, type <span class = 'code_font' style="color: red">help</span> and hit "Return" to see how to get started with commands. 
                </div>
                <div class="modal-body step-3" data-step="3">
                    Don't worry about it! Our <span class = font-weight-bold style="color: rgba(59, 116, 26, 0.973)">Auto-Save</span> feature will take care of saving any graph you create, so that you can focus on learning your material. <br> <br> 
                    Now that you have all the tools to begin, hit the <span class = font-weight-bold>tilde</span> key and run <span class = 'code_font' style="color: red">help</span> to get started! 
                </div>
                <div class="modal-footer">
                    <!-- <div class="form-check move-left">
                        <input type="checkbox" class="form-check-input move-left" id="exampleCheck1">
                        <label class="form-check-label" for="exampleCheck1">Don't show again</label>
                    </div> -->

                    <button type="button" class="btn btn-primary step step-2" data-step="2" onclick="sendEvent('#demo-modal-3', 1)">Back</button>
                    <button type="button" class="btn btn-primary step step-1" data-step="1" onclick="sendEvent('#demo-modal-3', 2)">Continue</button>
                    <button type="button" class="btn btn-primary step step-3" data-step="3" onclick="sendEvent('#demo-modal-3', 2)">Back</button>
                    <button type="button" class="btn btn-primary step step-2" data-step="2" onclick="sendEvent('#demo-modal-3', 3)">Continue</button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    
                </div>
            </div>
        </div>
    </div>


    <textarea></textarea>
    <script>
        
        // Get the URL parameters (graph id and node id)
        const urlParams = new URLSearchParams(window.location.search);
        const graphID = urlParams.get("graph_id"); 
        const nodeID = urlParams.get("node_id"); 
        const saveURL = "/node-save?" + "graph_id=" + graphID + "&node_id=" + nodeID;

        // On 'save', make a POST to the backend to save this content. 
        save = function() {
            $.post(saveURL, 
            {"markdown_text": easyMDE.value()}, 
            function() {
                console.log("save(): success"); 
            }); 
        }

        // Create the markdown editor. 
        var easyMDE = new EasyMDE({
            autoDownloadFontAwesome: true,
            tabSize: 4,
            toolbar: [
                "heading", "bold", "italic", "strikethrough", "|",
                "quote", "code", "unordered-list", "ordered-list", "|", 
                "link", "image", "table", "|",
                "preview", "side-by-side", "|",
                "guide", 
                {name: "save", 
                action: (editor) => {
                    save();
                },
                className: "fas fa-save", 
                title: "Custom Save button"},
            ]
        });
       
        // Load the stuff from the database. 
        $.post('/node-load', {'graph_id': graphID, 'node_id': nodeID}, 
            function(data, status) {
                easyMDE.value(data); 
            }
        );
    </script>

    <!-- multi-step modal js -->
    <script
        src="{{ url_for ('static', filename='js/multi-step-modal.js') }}"
    >
    </script>
    <script>
        sendEvent = function(sel, step) {
            var sel_event = new CustomEvent('next.m.' + step, {detail: {step: step}});
            window.dispatchEvent(sel_event);
        }
    </script>
</body>

<!-- jQuery -->
</html> 